from pyrogram import Client, filters, idle
import pyrogram, asyncio, random, time
from pyrogram.errors import FloodWait
from pyrogram.types import *
from variables import PICS, ADMIN
from utils.logo_maker import generate_logo


@Client.on_message(filters.command("logosq") & filters.incoming & filters.text & ~filters.forwarded & filters.private)
async def logosq(bot, message):
    try:
      text = message.text.replace("logosq","").replace("/","").replace("[á—·ETá—©]","").strip().upper()
      
      if text == "":
        return await message.reply_text("**To Make Logo -** /logo Your Name\n**To Make Square Logo - ** /logosq Your Name\n\n**â™»ï¸ Example:**\n/logo BETA\n/logosq BETA")
  
      x = await message.reply_text("`ğŸ” Generating Logo For You...`")  
      logo = await generate_logo(text,True)
  
      if "graph.org" not in logo:
        return await x.edit("`âŒ Something Went Wrong...`\n\nReport This Error In [SUPPORT GRP](t.me/beta_support).")
        
      if "error" in logo:
        return await x.edit(f"`âŒ Something Went Wrong...`\n\nReport This Error In [SUPPORT GRP](t.me/beta_support). \n\n`{logo}`")
        
      await x.edit("`ğŸ”„ Done Generated... Now Sending You`")
      
      logo_id = logo.replace("https://graph.org//file/","").replace(".jpg","").strip()
      
      await message.reply_photo(logo,caption = "**ğŸ–¼ Logo Generated By TG-MULTI-BOT**",reply_markup=InlineKeyboardMarkup([[InlineKeyboardButton(text="Upload As File ğŸ“", callback_data=f"flogo {logo_id}")]]))
      await x.delete()
    except FloodWait:
      pass
    except Exception as e:
      try:
        await x.delete()
      except:
        pass
      return await message.reply_text("`âŒ Something Went Wrong...`\n\nReport This Error In [á—·ETá—©]")

@Client.on_message(filters.command("logo") & filters.incoming & filters.text & ~filters.forwarded & filters.private)
async def logo(bot, message):
  try:
    text = message.text.replace("logo","").replace("/","").replace("@llathu63035","").strip().upper()
    
    if text == "":
      return await message.reply_text("**To Make Logo -** /logo Your Name\n**To Make Square Logo - ** /logosq Your Name\n\n**â™»ï¸ Example:**\n/logo BETA\n/logosq MKN")

    x = await message.reply_text("`ğŸ” Generating Logo For You...`")  
    logo = await generate_logo(text)

    if "graph.org" not in logo:
      return await x.edit("`âŒ Something Went Wrong...`\n\nReport This Error In  [SUPPORT GRP](t.me/beta_support).")
      
    if "error" in logo:
      return await x.edit(f"`âŒ Something Went Wrong...`\n\nReport This Error In [SUPPORT GRP](t.me/beta_support).\n\n`{logo}`")
      
    await x.edit("`ğŸ”„ Done Generated... Now Sending You`")

    logo_id = logo.replace("https://graph.org//file/","").replace(".jpg","").strip()
    await message.reply_photo(logo,caption = "**ğŸ–¼ Logo Generated By ğŸ‡³â€ŠğŸ‡¹â€ŠğŸ‡²â€Š**",reply_markup=InlineKeyboardMarkup([[InlineKeyboardButton(text="Upload As File ğŸ“", callback_data=f"flogo {logo_id}")]]))
    await x.delete()
  except FloodWait:
    pass
  except Exception as e:
    try:
      await x.delete()
    except:
      pass
    return await message.reply_text("`âŒ Something Went Wrong...`\n\nReport This Error In [á—·ETá—©]")


@Client.on_callback_query(filters.regex("flogo"))
async def logo_doc(_,query):
  await query.answer()
  try:
    x = await query.message.reply_text("`ğŸ”„ Sending You The Logo As File`")
    await query.message.edit_reply_markup(reply_markup=None)
    link = "https://graph.org//file/" + query.data.replace("flogo","").strip() + ".jpg"
    await query.message.reply_document(link,caption="**ğŸ–¼ Logo Generated By ğŸ‡³â€ŠğŸ‡¹â€ŠğŸ‡²â€Š**")
  except FloodWait:
    pass
  except Exception as e:
    try:
      return await x.edit(f"`âŒ Something Went Wrong...`\n\nReport This Error In [CONTACT](t.me/sula54321) \n\n`{str(e)}`")
    except:
      return
    
  return await x.delete()
